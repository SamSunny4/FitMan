<UserControl x:Class="FitMan.WPF.Views.MemberListView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:vm="clr-namespace:FitMan.WPF.ViewModels">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" Margin="0,0,0,20">
            <StackPanel Orientation="Horizontal">
                <materialDesign:PackIcon Kind="AccountGroup" 
                                        Width="36" 
                                        Height="36"
                                        VerticalAlignment="Center"
                                        Foreground="{DynamicResource PrimaryHueMidBrush}"/>
                <TextBlock Text="Members" 
                          FontSize="32" 
                          FontWeight="Bold" 
                          Margin="15,0,0,0"
                          VerticalAlignment="Center"/>
            </StackPanel>

            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Command="{Binding AddMemberCommand}"
                       Style="{StaticResource MaterialDesignRaisedButton}"
                       Margin="0,0,10,0">
                    <Button.Content>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Plus" VerticalAlignment="Center"/>
                            <TextBlock Text="Add Member" Margin="8,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button.Content>
                </Button>

                <Button Command="{Binding RefreshCommand}"
                       Style="{StaticResource MaterialDesignOutlinedButton}">
                    <Button.Content>
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="Refresh" VerticalAlignment="Center"/>
                            <TextBlock Text="Refresh" Margin="8,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button.Content>
                </Button>
            </StackPanel>
        </Grid>

        <!-- Search Bar -->
        <materialDesign:Card Grid.Row="1" Padding="15" Margin="0,0,0,15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBox Grid.Column="0"
                        Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                        materialDesign:HintAssist.Hint="Search by name, phone, email, or membership number"
                        Style="{StaticResource MaterialDesignOutlinedTextBox}"
                        FontSize="14">
                    <TextBox.InputBindings>
                        <KeyBinding Key="Escape" Command="{Binding RefreshCommand}"/>
                    </TextBox.InputBindings>
                </TextBox>

                <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="10,0,0,0">
                    <materialDesign:PackIcon Kind="Magnify" 
                                            Width="24" 
                                            Height="24"
                                            VerticalAlignment="Center"
                                            Opacity="0.6"/>
                    <TextBlock Text="{Binding Members.Count, StringFormat='{}{0} members'}" 
                              VerticalAlignment="Center"
                              Margin="10,0,0,0"
                              FontWeight="SemiBold"
                              Foreground="{DynamicResource PrimaryHueMidBrush}"/>
                </StackPanel>
            </Grid>
        </materialDesign:Card>

        <!-- Members DataGrid -->
        <materialDesign:Card Grid.Row="2">
            <DataGrid ItemsSource="{Binding Members}"
                     SelectedItem="{Binding SelectedMember}"
                     AutoGenerateColumns="False"
                     CanUserAddRows="False"
                     CanUserDeleteRows="False"
                     SelectionMode="Single"
                     IsReadOnly="True"
                     materialDesign:DataGridAssist.CellPadding="13 8 8 8"
                     materialDesign:DataGridAssist.ColumnHeaderPadding="8">
                
                <DataGrid.Columns>
                    <!-- Membership Number -->
                    <DataGridTextColumn Header="Member #" 
                                       Binding="{Binding MembershipNumber}"
                                       Width="100">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="FontWeight" Value="SemiBold"/>
                                <Setter Property="Foreground" Value="{DynamicResource PrimaryHueMidBrush}"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <!-- Full Name -->
                    <DataGridTextColumn Header="Name" 
                                       Binding="{Binding FullName}"
                                       Width="200">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="FontWeight" Value="Medium"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>

                    <!-- Phone -->
                    <DataGridTextColumn Header="Phone" 
                                       Binding="{Binding Phone}"
                                       Width="130"/>

                    <!-- Email -->
                    <DataGridTextColumn Header="Email" 
                                       Binding="{Binding Email}"
                                       Width="*"/>

                    <!-- Status -->
                    <DataGridTemplateColumn Header="Status" Width="100">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border CornerRadius="10" 
                                       Padding="8,3"
                                       HorizontalAlignment="Center">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Status}" Value="Active">
                                                    <Setter Property="Background" Value="LightGreen"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Status}" Value="Inactive">
                                                    <Setter Property="Background" Value="LightGray"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Status}" Value="Suspended">
                                                    <Setter Property="Background" Value="OrangeRed"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <TextBlock Text="{Binding Status}" 
                                              FontWeight="SemiBold"
                                              FontSize="11"
                                              HorizontalAlignment="Center"/>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Enrollment Date -->
                    <DataGridTextColumn Header="Joined" 
                                       Binding="{Binding EnrollmentDate, StringFormat='{}{0:MM/dd/yyyy}'}"
                                       Width="100"/>

                    <!-- Actions -->
                    <DataGridTemplateColumn Header="Actions" Width="180">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <Button Style="{StaticResource MaterialDesignIconButton}"
                                           ToolTip="View Details"
                                           Command="{Binding DataContext.ViewMemberCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                           CommandParameter="{Binding}"
                                           Width="30"
                                           Height="30">
                                        <materialDesign:PackIcon Kind="Eye" Width="18" Height="18"/>
                                    </Button>

                                    <Button Style="{StaticResource MaterialDesignIconButton}"
                                           ToolTip="Edit Member"
                                           Command="{Binding DataContext.EditMemberCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                           CommandParameter="{Binding}"
                                           Width="30"
                                           Height="30"
                                           Margin="5,0">
                                        <materialDesign:PackIcon Kind="Pencil" Width="18" Height="18"/>
                                    </Button>

                                    <Button Style="{StaticResource MaterialDesignIconButton}"
                                           ToolTip="Delete Member"
                                           Command="{Binding DataContext.DeleteMemberCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                           CommandParameter="{Binding}"
                                           Width="30"
                                           Height="30"
                                           Foreground="Red">
                                        <materialDesign:PackIcon Kind="Delete" Width="18" Height="18"/>
                                    </Button>
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </materialDesign:Card>

        <!-- Loading Overlay -->
        <Grid Grid.RowSpan="3" 
             Background="#80000000"
             Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                            Value="0"
                            IsIndeterminate="True"
                            Width="60"
                            Height="60"/>
                <TextBlock Text="Loading members..." 
                          Foreground="White"
                          FontSize="16"
                          Margin="0,20,0,0"
                          HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>
